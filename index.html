<!DOCTYPE html>
<html lang="en" xmlns:mso="urn:schemas-microsoft-com:office:office"
    xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Presentation</title>
    <link rel="stylesheet" href="css/serticket-styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="js/vg-ticket.js"></script>
    <script src="js/vg-util-updownside.js"></script>
    <script src="js/flbook.js"></script>

    <!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_SharedWithUsers msdt:dt="string">Brian Kremmel</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_SharedWithUsers>
<mso:SharedWithUsers msdt:dt="string">55;#Brian Kremmel</mso:SharedWithUsers>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>
    <!--WO SETUP-----------------------
            Tech will begin here

            Inputs:
             - Any WO Info
             - Any Customer Info
             - Any System Information
             - Flat Rate Items (none approved)
        -->
    <!--Ticket Header------------------------->
    <div id="wo-header-cont" class="twelve-col-grid">
        <img src="images/Vogel Logo.png" id="header-logo" alt="VOGEL"><div id="wo-presentation-header">REWARDS MEMBERSHIP SAVINGS</div>
    </div>


    <!--NAVIGATION

    -->

    <style>
      .vg-utilcont-toggle{
        display:flex;
        justify-self:center;
        text-align:center;
        width:50px;
        height:40px;
        background-color:rgba(84, 112, 207, .4);
      }
      .vg-utilcont{
        display:none;
        position:fixed;
      }
      .vg-utilcont-info{
        display:none;
      }


      #vg-utilcont-top{
        display:inline-grid;
        top:0;
        width:100%;
      }
      .vg-utilcont-top-info{
        height:50%;
      }


      #vg-utilcont-bottom{
        bottom:0;
        width:100%;
      }
      .vg-utilcont-bottom-info{
        min-height:200px;
      }

      #vg-utilcont-right{
        display:flex;
        right:0;
        height:100%;
      }
      .vg-utilcont-right-info{
        min-width:200px;
      }
    </style>
    <div id="vg-utilcont-top" class="vg-utilcont" style="display:none">
      <div class="vg-utilcont-top-info vg-utilcont-info">
        this
      </div>
      <div class="vg-utilcont-toggle">
        >
        <button id="wo-save" style="justify-content:flex-end;">Create PDF</button>
      </div>
    </div>
    <div id="vg-utilcont-bottom" class="vg-utilcont"  style="display:none">
      <div class="vg-utilcont-toggle">
        >
      </div>
      <div class="vg-utilcont-bottom-info vg-utilcont-info">
        <!--PRESENTATION 1---------->
        <div id="wo-presentation-cont" class="twelve-col-grid">
            <div id="wo-present-repair-cont">
                <div class="wo-present-repair">
                  <div id="wo-present-membership">
                    Premium
                  </div>
                </div>
                <div class="wo-present-repair" style="font-weight:bold">
                    <div>Benefit & Advantage (C/P)</div>
                    <div>Regular Price</div>
                    <div>Memeber Price</div>
                    <div>Savings</div>
                    <div>Approved?</div>
                </div>
                <!--ALL OF THE REPAIRS BELOW-->

                <div class="wo-present-repair">
                    <!--DIAGNOSTIC FEE-->
                    <div class="present-repair-desc">Diagnostic</div>
                    <div class="present-repair-price">$119</div>
                    <div class="present-repair-savings"></div>
                    <input class="present-repair-appr" type="checkbox" />
                </div>

                <div id="wo-present-systems">
                </div>
            <!--INVESTMENT SECTION-->
            <div class="wo-present-repair"><!--Line GRID-->
                <div>DUE TODAY</div><!--TITLE-->
                <input id="wo-present-regprice-today"/>
                <input id="wo-present-memprice-today"/>
                <input id="wo-present-savings-today"/>
            </div>

            </div>
        </div>
      </div>
    </div>

    <!--RIGHT SIDE UTILITY
        The right side utility bar will hold the contract information
        in the vg-utilcont-info > div
    -->
    <div id="vg-utilcont-right" class="vg-utilcont" style="display:none">
      <div class="vg-utilcont-toggle">
        >
      </div>
      <div class="vg-utilcont-right-info vg-utilcont-info">
        <div id="wo-present-contract-cont">
            <input id="present-contract-name" type="search" list="contract-name-list" />
            <div id="present-contract-opts">
                <div class="present-contract-opt">
                    <div class="present-contract-opt-desc" id="monthly-tag">Monthly Plan</div>
                    <div>------</div>
                    <div id="present-contract-monthly">$24</div><input type="checkbox" />
                </div>

                <div class="present-contract-opt">
                    <div class="present-contract-opt-desc">Additional System(s)</div><input
                        class="present-contract-opt-quantity" type="number" />
                    <div id="present-contract-addsys">$21</div><input class="present-contract-opt-appr"
                        type="checkbox" />
                </div>
                <div class="present-contract-opt">
                    <div class="present-contract-opt-desc">Additional Component(s)</div><input
                        class="present-contract-opt-quantity" type="number" />
                    <div id="present-contract-addcomp">$12</div><input class="present-contract-opt-appr"
                        type="checkbox" />
                </div>

                <div id="enhance-tag">Enhancements</div>

                <div class="present-contract-opt">
                    <div class="present-contract-opt-desc">Standard Filters</div><input
                        class="present-contract-opt-quantity" type="number" />
                    <div id="present-contract-addstdflt">$5</div><input class="present-contract-opt-appr"
                        type="checkbox" />
                </div>
                <div class="present-contract-opt">
                    <div class="present-contract-opt-desc">Humidifier Service/Pad</div><input
                        class="present-contract-opt-quantity" type="number" />
                    <div id="present-contract-addhumpad">$5</div><input class="present-contract-opt-appr"
                        type="checkbox" />
                </div>
                <div class="present-contract-opt">
                    <div class="present-contract-opt-desc">Specialty Filters</div><input
                        class="present-contract-opt-quantity" type="number" />
                    <div id="present-contract-addspcflt">$12</div><input class="present-contract-opt-appr"
                        type="checkbox" />
                </div>
                <div class="present-contract-opt">
                    <div class="present-contract-opt-desc">Time Saver Disc.</div><input
                        class="present-contract-opt-quantity" type="number" />
                    <div id="present-contract-addtimesave">-$4</div><input class="present-contract-opt-appr"
                        type="checkbox" />
                </div>
            </div>
        </div>
      </div>
    </div>
    <!---->


    <!--Client / WO info---------------------->
    <div id="wo-client-cont" class="twelve-col-grid">
        <div class="client-label">WO Num:</div><input id="wo-info-num" type="text" />
        <div class="client-label">Client:</div><input id="wo-info-customer" class="client-input" type="text" />
        <div class="client-label">Address:</div><input id="wo-info-address" class="client-input" type="text" />
    </div>

    <!--Repair Selection----------------------->
    <div id="wo-setup-cont" class="twelve-col-grid">
        <!--Setup Systems--------------
                Filter options on top of a
                table with the systesms.

                Most of the editing is done
                in the table
            -->
        <div id="wo-setup-sys">
            <div id="wo-setup-tag-selector"><label for="tagid">Add Tag ID: </label><input id="wo-setup-sys-tagid" name="tagid" /></div>
            <!-- WO System Table-----------
                    Holds all of the customers
                    service items.

                    ADD: Empty row at end

                    UPDATE: Can type in some
                    table cells.

                    DELETE: Maybe should only
                    be able to disable, setting
                    a flag back at the office.
                -->
            <div id="wo-sys-list"></div>
            <!---------------------------->
        </div>

        <!--Setup Repair List----------
                Holds an area to search and
                selected different task items
                from the loaded flat rate
                book.
            -->
        <div id="wo-setup-repair">
            <div>
                <!--FLATBOOK------------>
                <input id="wo-repair-search-book" placeholder="Select Price Book" type="search"
                    list="flatrate-book-list" />
                <!--List of all available flat rate books-->
                <input id="wo-repair-search-pl" placeholder="Select Price Level" type="search"
                    list="flatrate-book-pl-list" />
                <!--List of all available price level in selected book-->
                <input id="wo-repair-search-column" placeholder="Select Filter Type" type="search"
                    list="flatrate-book-search-list" />
                <!--List of the first-->
                <input id="wo-repair-search-value" placeholder="Search Repair" type="text" />
                <!--Type to find-->

                <div id="wo-flatrate-cont">
                    <div id="flatrate-search-table-cont">
                        <table id="flatrate-search-table">
                        </table>
                    </div>
                </div>
            </div>
            <!---------------------------->
        </div>
        <!---------------------------->
    </div>


    <!--BLOCK TO HOLD DATALIST-->
    <div>
        <datalist id="flatrate-book-search-list">
            <option>Task Code</option>
            <option>Task Description</option>
        </datalist>
        <datalist id="flatrate-book-list">
            <option>Res Book</option>
            <option>Comm Book</option>
        </datalist>
        <datalist id="flatrate-book-pl-list">
        </datalist>

        <datalist id="contract-name-list">
            <option>CLASSIC</option>
            <option>PREMIUM</option>
            <option>ULTIMATE</option>
        </datalist>

    </div>
    <!--Buttons / Nav-------------------------->
    <div id="wo-nav">
    </div>
</body>
<script>

    var conprice = {
        CLASSIC: {
            pl: 'CLA',
            month: 24,
            add: {
                sys: 21,
                comp: 12,
                stdflt: 5,
                humpad: 5,
                spcflt: 12,
                timesave: -4
            }
        },
        PREMIUM: {
            pl: 'PRE',
            month: 33,
            add: {
                sys: 29,
                comp: 12,
                stdflt: 0,
                humpad: 0,
                spcflt: 7,
                timesave: -4
            }
        },
        ULTIMATE: {
            pl: 'ULT',
            month: 44,
            add: {
                sys: 37,
                comp: 12,
                stdflt: 0,
                humpad: 0,
                spcflt: 7,
                timesave: -4
            }
        }
    }




    var wodom = {
        cont: '',
        info: {
            num: 'wo-info-num',
            name: 'wo-info-customer',
            address: 'wo-info-address'
        }
    }

    var wodate = new Date();
    var curbook = fltbook.res;//set flat rate book to Residential Book
    var curwo = null; //set the current WO to null


    //  PRESENTATION    ////////////////////////////////////////////////

    //Presentation DOM
    var prsdom = {
        cont: 'wo-presentation-cont',
        head: 'wo-presentaiton-header',
        contract: {
            cont: 'wo-present-contract-cont',
            form: {
                cont: 'present-contract-opts',

                desc: 'present-contract-opt-desc',
                quantity: 'present-contract-opt-quantity',
                appr: 'present-contract-opt-appr',
                name: 'present-contract-name',
                month: 'present-contract-monthly',

                inputs: {
                    sys: 'present-contract-addsys',
                    comp: 'present-contract-addcomp',
                    stdflt: 'present-contract-addstdflt',
                    spcflt: 'present-contract-addspcflt',
                    humpad: 'present-contract-addhumpad',
                    timesave: 'present-contract-addtimesave'
                }
            }
        },
        systems: 'wo-present-systems',
        system: {
            cont: 'wo-present-system',
            id: 'wo-present-system-id',
            repairs: 'wo-present-system-repairs',
            repair: {
                cont: 'wo-present-repair',
                num: 'present-repair-num',
                desc: 'present-repair-desc',
                invst: 'present-repair-price',
                savings: 'present-repair-savings',
                appr: 'present-repair-appr'
            }
        },
        invest: {
            savings: 'wo-present-savings-today',
            regprice: 'wo-present-regprice-today',
            memprice: 'wo-present-memprice-today',
            conmonth: ''
        }
    }

    var SETpresent = (cwo) => {
        if (cwo.systems != null) {
            let slist = document.getElementById(prsdom.systems)
            let repcost = 0;
            let repsave = 0;

            slist.innerHTML = '';


            for (let x = 0; x < cwo.systems.length; x++) {
                let s = slist.appendChild(document.createElement('div'));
                s.classList.add(prsdom.system.cont);
                s.appendChild(document.createElement('div')).innerText = cwo.systems[x].id;
                let rlist = s.appendChild(document.createElement('div'));
                rlist.classList.add(prsdom.system.repairs);

                for (let y = 0; y < cwo.systems[x].repairs.length; y++) {
                    repcost += cwo.systems[x].repairs[y].value;

                    //tell what column repcost goes to

                    //find the memebership cost (if any)

                    //fill the difference
                    let r = rlist.appendChild(document.createElement('div'));
                    r.classList.add(prsdom.system.repair.cont);
                    //r.appendChild(document.createElement('div')).innerText = cwo.systems[x].repairs[y].num;
                    r.appendChild(document.createElement('div')).innerText = cwo.systems[x].repairs[y].desc;
                    r.appendChild(document.createElement('div')).innerText = cwo.systems[x].repairs[y].value;
                    r.appendChild(document.createElement('div')).innerText = Math.abs(curwo.systems[x].repairs[y].value - GETbookprice(cwo.systems[x].repairs[y].num, cwo.cntrct));
                    repsave += Number(r.children[r.children.length - 1].innerText);
                    r.appendChild(document.createElement('input')).type = "checkbox";
                }
            }

            document.getElementById(prsdom.invest.regprice).value = repcost;
            document.getElementById(prsdom.invest.memprice).value = 89
            document.getElementById(prsdom.invest.savings).value = repsave;
            document.getElementById(prsdom.invest.month).value = GETcntrctprice();
        }
    }

    var SETprice = () => {
    }

    var SETprestype = (pl) => {
        if (pl != '') {
            if (pl == 'CLA' || pl == 'PRE' || pl == 'ULT') { //has a contract
                document.getElementById(prsdom.contract.form.name).value = '';
                //make other adjustments
                $(document.getElementById(prsdom.contract.form.cont)).hide();//collapse contract form
                return true;
            } else if (pl == 'STA' || pl == 'AHR') { //does not have a contract
                document.getElementById(prsdom.contract.form.name).value = document.getElementById(prsdom.contract.form.name).value == '' ? 'PREMIUM' : document.getElementById(prsdom.contract.form.name).value;
                $(document.getElementById(prsdom.contract.form.cont)).show();//expand contract form
                return false;
            }
        }


    }

    //  CONTRACT FORM   ////////////////////////
    var SETcntrctform = () => {
        let conname = document.getElementById(prsdom.contract.form.name).value;
        if (conname != '' && conprice[conname] != undefined) {
            document.getElementById(prsdom.contract.form.month).innerText = conprice[conname].month;
            for (let p in prsdom.contract.form.inputs) {
                document.getElementById(prsdom.contract.form.inputs[p]).innerText = conprice[conname].add[p];
            }
        }
    }

    //returns the contract price from form, multiplied by pmnts (pmnts=12 == annual payment)
    var GETcntrctprice = (pmnts = 1) => {
        let conname = document.getElementById(prsdom.contract.form.name).value;
        let price = 0;
        if (conname != '' && conprice[conname] != undefined) {
            price = Number(document.getElementById(prsdom.contract.form.month).innerText);
            for (let i in prsdom.contract.form.inputs) {
                let opt = document.getElementById(prsdom.contract.form.inputs[i]).parentNode;
                if (opt.getElementsByClassName(prsdom.contract.form.appr)[0].checked) {
                    price += Number(document.getElementById(prsdom.contract.form.inputs[i]).innerText) * (opt.getElementsByClassName(prsdom.contract.form.quantity)[0].value != '' ? opt.getElementsByClassName(prsdom.contract.form.quantity)[0].value : 0);
                }
            }
        }
        return price;
    }
    ////////////////////////////////////////////

    ////////////////////////////////////////////////////////////////////


    //  WO system   ////////////////////////////////////////////////////

    //System DOM
    var sysdom = {
        input: {
            tagid: "wo-setup-sys-tagid"
        },

        list: {
            cont: 'wo-sys-list',
            system: {
                cont: 'wo-sys',
                button: 'wo-sys-button',
                tagid: 'wo-sys-tagid',
                area: 'wo-sys-area',
                repairs: 'wo-sys-repairs',
                repair: {
                    cont: 'wo-sys-repair',
                    id: 'wo-sys-repair-id',
                    desc: 'wo-sys-repair-desc',
                }
            },
            selected: 'wo-sys-selected'
        }
    };

    var CLEARSysSelect = () => {
        let replist = document.getElementsByClassName(sysdom.list.selected);
        for (let x = 0; x < replist.length; x++) {
            $(replist[x].getElementsByClassName(sysdom.list.system.repairs)[0]).hide();
            console.log(replist[x])
            replist[x].classList.remove(sysdom.list.selected);
        }
    }

    var ADDsystem = (system = { id: '' }) => {
        if (system.id != '') {
            let syslist = document.getElementById(sysdom.list.cont);

            let sys = syslist.appendChild(document.createElement('div'));

            CLEARSysSelect();

            sys.classList.add(sysdom.list.system.cont);
            sys.classList.add(sysdom.list.selected);

            sys.appendChild(document.createElement('div')); //button to toggle repair list
            sys.children[sys.children.length - 1].classList.add(sysdom.list.system.button);
            sys.children[sys.children.length - 1].innerText = '>'


            sys.appendChild(document.createElement('input')).value = system.id; //tag id input
            sys.children[sys.children.length - 1].classList.add(sysdom.list.system.tagid);
            sys.appendChild(document.createElement('input')).value = system.area ? sys.area : '';
            sys.children[sys.children.length - 1].classList.add(sysdom.list.system.area); //sys area input

            //Input Repairs
            sys.appendChild(document.createElement('div'));
            sys.children[sys.children.length - 1].classList.add(sysdom.list.system.repairs); //sys repair list

            if (sys.repairs != undefined) {
                for (let reps = 0; reps < sys.repairs.length; reps++) {
                    ADDrepair(sys.repairs[reps]);
                }
            }
            //button to show/hide repairs
            sys.children[0].addEventListener('click', (ele) => {

                CLEARSysSelect();
                ele.target.parentNode.classList.add(sysdom.list.selected);
                let replist = ele.target.parentNode.getElementsByClassName(sysdom.list.system.repairs)[0];

                //need to check attribut display
                if ($(replist).is(':visible')) { $(replist).hide(); }
                else { $(replist).show(); }
            });

        }

    }

    /*  Add repair
        PASS:{
            task,
            desc
        }
    */
    var ADDrepair = (row = {}) => {
        let rlist = document.getElementsByClassName(sysdom.list.selected)[0].getElementsByClassName(sysdom.list.system.repairs)[0];
        let r = rlist.appendChild(document.createElement('div'));
        r.classList.add(sysdom.list.system.repair.cont);
        r.appendChild(document.createElement('div')).innerText = row.task != undefined ? row.task : '' //inrow.children[0].innerText;
        r.children[r.children.length - 1].classList.add(sysdom.list.system.repair.id);
        r.appendChild(document.createElement('div')).innerText = row.desc != undefined ? row.desc : '' //inrow.target.parentNode.children[1].innerText;
        r.children[r.children.length - 1].classList.add(sysdom.list.system.repair.desc);
    }

    //gets the system info
    var GETSysList = () => {
        let syslist = document.getElementById(sysdom.list.cont);
        let arr = [];
        for (let x = 0; x < syslist.children.length; x++) {
            arr.push(
                (() => {
                    let obj = {
                        id: syslist.children[x].getElementsByClassName(sysdom.list.system.tagid)[0].value,
                        area: syslist.children[x].getElementsByClassName(sysdom.list.system.area)[0].value,
                        repairs: []
                    };
                    let rlist = syslist.children[x].getElementsByClassName(sysdom.list.system.repairs)[0];
                    for (let y = 0; y < rlist.children.length; y++) { //add a repair
                        obj.repairs.push({
                            num: rlist.children[y].getElementsByClassName(sysdom.list.system.repair.id)[0].innerText,
                            desc: rlist.children[y].getElementsByClassName(sysdom.list.system.repair.desc)[0].innerText,
                            value: GETbookprice(rlist.children[y].getElementsByClassName(sysdom.list.system.repair.id)[0].innerText, document.getElementById(fbdom.search.pl).value),
                            appr: true
                        });
                    }
                    return obj;
                })());
        }
        return arr
    }

    //gets the wo info from dom
    var GETwo = () => {
        let conname = document.getElementById(prsdom.contract.form.name).value;

        return {
            num: document.getElementById(wodom.info.num).value,
            name: document.getElementById(wodom.info.name).value,
            address: document.getElementById(wodom.info.address).value,
            book: {
                name: document.getElementById(fbdom.search.book).value,
                pl: document.getElementById(fbdom.search.pl).value
            },
            cntrct: (conname != '' ? conprice[conname].pl : defpl),
            hascntrct: SETprestype(document.getElementById(fbdom.search.pl).value), //NEED to account for contract upgrade presentation!!
            systems: GETSysList()
        }
    }

    ////////////////////////////////////////////////////////////////////


    //  Flate Rate  ////////////////////////////////////////////////////

    //  Flate Rate DOM
    var fbdom = {
        cont: 'wo-setup-repair',
        search: {
            book: 'wo-repair-search-book',
            value: 'wo-repair-search-value',
            pl: 'wo-repair-search-pl',
            fltr: 'wo-repair-search-column'
        },
        table: {
            cont: 'flatrate-search-table',
            row: {
                cont: '',
                task: 'flatrate-taskid',
                desc: 'flatrate-desc',
                value: 'flatrate-value'
            }
        },
        lists: {
            pls: 'flatrate-book-pl-list'
        }
    }
    document.getElementById(fbdom.search.book).addEventListener('change', switchBook);
    document.getElementById(fbdom.search.value).addEventListener('change', getSearchList);
    document.getElementById(fbdom.search.pl).addEventListener('change', (ele) => {
        SETprestype(ele.target.value);
        getSearchList(ele);
    });
    ////////////////////////////////////////////////////////////////////

    //PRINT Button
    document.getElementById('wo-save').addEventListener('click', (ele) => {
        window.print();
    });

    //WO Number CHANGE
    document.getElementById(wodom.info.num).addEventListener('change', (ele) => { //WO number input change
        if (ele.target.value != '') {
            document.getElementsByTagName('title')[0].innerText = ele.target.value;
            $(document.getElementById('wo-setup-sys')).show();
            $(document.getElementById('wo-setup-repair')).show();
        }
    });

    //Tag ID CHANGE, adds a system to the list
    document.getElementById(sysdom.input.tagid).addEventListener('change', (ele) => {
        ADDsystem({
            id: ele.target.value
        });
        ele.target.value = '';
    });

    //Contract Form CHANGE
    document.getElementById(prsdom.contract.cont).addEventListener('change', (ele) => {
        SETcntrctform();
        GETcntrctprice();
    });

    //Document CHANGE
    document.addEventListener('change', (ele) => {
        curwo = GETwo();
        console.log(curwo);
        SETpresent(curwo);
    });

    var defpl = (() => { //get STD or AHR price level depending on time and/of day
        let time = wodate.getHours();
        let day = wodate.getDay();
        return (
            (time > 17 ||
                day >= 6)
                ? 'AHR' : 'STA'
        );
    })();

    document.getElementById(prsdom.contract.form.name).value = "PREMIUM";


  console.log(defpl);
    document.getElementById(fbdom.search.pl).value = defpl;


    console.log(curbook);

    SETupdownside(true,true,true,false);


</script>

</html>
